{# ---- 统一代码块缩进宏：首行+每行都缩进四空格 ---- #}
{% macro indent4(s) -%}
{{- '    ' + (s|trim|replace('\r\n','\n')|replace('\n','\n    ')) -}}
{%- endmacro %}

.. _cmd-{{ cmd_name|lower }}:

{{ cmd_name }}：{{ cmd_title }}
{{ '-' * (cmd_name|length + cmd_title|length + 5) }}

{{ desc }}

命令格式
^^^^^^^^
{% set label_map = {"执行":"执行命令", "查询":"查询命令", "测试":"测试命令", "设置":"设置命令"} -%}
{% for st in subtypes -%}
{% set label = label_map.get(st.type, "命令") -%}
**{{ label }}**
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**命令：**

::

{{ indent4(st.fmt) }}

**响应：**

::

{% if st.response.strip() -%}
{{ indent4(st.response) }}

{% else -%}
{{ indent4('OK') }}

{% endif -%}
{% endfor -%}

参数
^^^^
{% if parameters -%}
{% for k, v in parameters.items() -%}
- **{{ k }}**： {{ (v.get('__desc__') or '')|trim }}
{% for opt, text in v.items() if opt != '__desc__' -%}
  - {{ opt }}：{{ text }}
{% endfor -%}
{% endfor -%}
{% else -%}
(无参数)
{% endif -%}


命令示例
^^^^^^^^
{% set examples = [] -%}
{% for st in subtypes -%}
  {% if st.example and st.example.strip() -%}
    {% set _ = examples.append(st.example.strip()) -%}
  {% endif -%}
{% endfor -%}
{% if examples and examples|join('')|trim -%}
::

{% for ex in examples -%}
{{ indent4(ex) }}

{% endfor -%}
{% else -%}
(无示例)
{% endif -%}


说明
^^^^
{{ note.strip() if note else "(无说明)" }}

